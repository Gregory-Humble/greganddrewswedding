<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Greg & Drew — Wedding Invitation</title>
    <meta name="description" content="You're invited to celebrate Greg & Drew. RSVP online.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,300..700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
    @font-face {
    font-family: 'Marquis';
    src: url('assets/fonts/Marquis-Regular.woff2') format('woff2'),
         url('assets/fonts/Marquis-Regular.woff') format('woff');
    font-weight: 500;
    font-style: normal;
    font-display: swap;
    }
     @font-face {
    font-family: 'Montage';
    src: url('assets/fonts/MontageSerifFont-Regular.woff2') format('woff2'),
         url('assets/fonts/MontageSerifFont-Regular.woff') format('woff');
    font-weight: 500;
    font-style: normal;
    font-display: swap;
    }
     @font-face {
    font-family: 'Majesty';
    src: url('assets/fonts/Majesty_YandiDesigns.woff2') format('woff2'),
         url('assets/fonts/Majesty_YandiDesigns.woff') format('woff');
    font-weight: 500;
    font-style: normal;
    font-display: swap;
    }
      
      :root{
        --accent:#0f172a;
        /* Swap to your uploaded path if needed */
        --page-image:url('assets/Koons9.jpg');
      }
      .font-display{font-family:'Fraunces',ui-serif,Georgia,serif;}
      .font-sans{font-family:'Inter',ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial,'Noto Sans';}
      .font-handwritten{font-family:'Indie Flower',cursive;}
      .font-montserrat{font-family: 'Montserrat', sans-serif;}
      .font-quicksand{font-family: 'Quicksand', sans-serif;}
      .font-marquis{font-family: 'Marquis', serif;}
      .font-montage{font-family: 'Montage', serif;}
      .font-majesty{font-family: 'Majesty', sans-serif;} 
      .tabular-nums{font-variant-numeric:tabular-nums;}

      /* Fixed background behind everything */
      #page-bg{position:fixed;inset:0;z-index:-10}
      #page-bg .img{position:absolute;inset:0;background-image:var(--page-image);background-size:cover;background-position:center}
      #page-bg .veil{
      position:absolute;inset:0;pointer-events:none;
      /* Slightly stronger veil + soft vertical tint */
      background:
      linear-gradient(to bottom, rgba(2,6,23,.14) 0%, rgba(2,6,23,.18) 35%, rgba(2,6,23,.20) 70%, rgba(2,6,23,.24) 100%),
      radial-gradient(ellipse at 30% 20%, rgba(2,6,23,.10), transparent 55%),
      radial-gradient(ellipse at 70% 80%, rgba(2,6,23,.10), transparent 55%),
      rgba(2,6,23,.06);
      }

      /* “Glass” cards for readability over image (tighter) */
      .glass{
        backdrop-filter:saturate(120%) blur(7px);
        -webkit-backdrop-filter:saturate(120%) blur(7px);
        background:rgba(255,255,255,.42);
        border:1px solid rgba(255,255,255,.10);
        box-shadow:0 8px 24px rgba(2,6,23,.08);
      }

      .input-solid{background:#fff}
      .text-shadow-soft{text-shadow:0 1px 2px rgba(0,0,0,.25)}

      /* iOS Safari fallback (fixed backgrounds stutter on iOS) */
      .ios #page-bg{ position:absolute}

      /* iOS: switch to a solid backdrop after the hero for readability */
      .ios.ios-solid-bg,
      .ios.ios-solid-bg body {
      background:#0006A8 !important;   /* your solid colour */
      }
      /* iOS: hide global full-page image; paint hero itself with the image.
      Everything after the hero uses the solid blue page background. */
      .ios #page-bg { display:none; }

      .ios #hero{
        background-image: var(--page-image);
        background-size: cover;
        background-position: center;
        position: relative;            /* for the overlay below */
        }

      .ios #hero::before{
        content:"";
        position:absolute; inset:0; pointer-events:none;
  
        /* same veil you use elsewhere */
      background:
        linear-gradient(to bottom, rgba(2,6,23,.14) 0%, rgba(2,6,23,.18) 35%, rgba(2,6,23,.20) 70%, rgba(2,6,23,.24) 100%),
        radial-gradient(ellipse at 30% 20%, rgba(2,6,23,.10), transparent 55%),
        radial-gradient(ellipse at 70% 80%, rgba(2,6,23,.10), transparent 55%),
        rgba(2,6,23,.06);
        }

/* solid blue for everything after the hero */
.ios, .ios body{ background:#0006A8; }
      /* Make the hero-only bg reuse the same image/veil styles */
      #hero-bg .img{
      position:absolute; inset:0;
      background-image:var(--page-image);
      background-size:cover; background-position:center;
      }
      #hero-bg .veil{
      position:absolute; inset:0; pointer-events:none;

      }

/* iOS: hide the global full-page image; paint a solid behind the hero */
.ios,
.ios body{
  background:#0006A8;            /* your solid blue for everything after the hero */
}
.ios #page-bg{ display:none; }    /* remove the full-page image layer on iOS */
.ios #hero-bg{ display:block; }   /* ensure hero-only image shows on iOS */
    
/* THEMED RSVP PILLS — subtle rose to match page */
:root{
  /* base (unchanged, just a touch softer) */
  --pill-bg: rgba(255,255,255,.88);
  --pill-text: #0b1220;
  --pill-border: rgba(255,255,255,.55);

  /* active — soft rose */
  --pill-active-bg: rgba(251, 113, 133, .85);   /* ≈ tailwind rose-400 */
  --pill-active-text: #ffffff;
  --pill-active-border: rgba(254, 205, 213, .95);/* ≈ rose-200 */
  --pill-active-shadow: 0 6px 18px rgba(251, 113, 133, .28);
  --pill-focus-ring: 0 0 0 3px rgba(253, 164, 175, .35); /* ≈ rose-300 */
}

/* base look */
.pill{
  display:inline-flex; align-items:center; gap:.5rem;
  padding:.375rem .625rem; border-radius:.75rem;
  border:1px solid var(--pill-border);
  background:var(--pill-bg); color:var(--pill-text);
  cursor:pointer; user-select:none; transition:all .2s ease;
}

/* hover / focus (soft, not shouty) */
.pill:hover{ filter:brightness(.99); border-color: var(--pill-active-border); }
.pill:focus-within{ outline: none; box-shadow: var(--pill-focus-ring); }

/* active state */
.pill.is-active{
  background:var(--pill-active-bg);
  color:var(--pill-active-text);
  border-color:var(--pill-active-border);
  box-shadow:var(--pill-active-shadow);
}

/* (Optional) hover on active — tiny lift */
.pill.is-active:hover{ filter:brightness(1.02); }

/* RSVP inputs: darker text for legibility on white fields */
#rsvp .input-solid{
  background:#fff;
  color:#1f2937;              /* slate-800 */
  caret-color:#1f2937;
}

/* Placeholder colour (subtle) */
#rsvp .input-solid::placeholder{
  color:#94a3b8;              /* slate-400 */
  opacity:1;
}

/* iOS/Chrome autofill: prevent pale/pinkish text */
#rsvp input:-webkit-autofill,
#rsvp textarea:-webkit-autofill{
  -webkit-text-fill-color:#1f2937;  /* slate-800 */
  transition: background-color 9999s ease-out 0s;
}

/* Optional: make all RSVP field labels consistently light */
#rsvp .field-label{
  color:rgba(250, 250, 249, .92);   /* ~ stone-100 */
}
      
    </style>
  </head>

  
  <body class="font-sans text-slate-800">
    <!-- Global fixed background -->
    <div id="page-bg" aria-hidden="true">
      <div class="img"></div>
      <div class="veil"></div>
    </div>

    <noscript>
      <div class="mx-auto max-w-3xl m-3 p-3 rounded-xl glass">
        This site needs JavaScript enabled for RSVP and maps links.
      </div>
    </noscript>

    <!-- NAV (tighter) -->
<header class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/55 bg-white/65 border-b border-white/30">
  <div class="w-full px-2 md:px-4 py-3 flex items-center">
    <span class="font-quicksand tracking-wider text-sm md:text-lg">G · D</span>
    <nav class="ml-auto font-quicksand flex gap-5 text-sm md:text-lg">
      <a href="#details" class="hover:text-emerald-800">The Details</a>
      <a href="#schedule" class="hover:text-emerald-800">Schedule</a>
      <a href="#venue" class="hover:text-emerald-800">Venues</a>
      <a href="#rsvp" class="hover:text-emerald-800">RSVP</a>
    </nav>
  </div>
</header>

<!-- HERO (names centred; reserved bottom area so countdown is always visible) -->
<section id="hero" class="relative flex flex-col min-h-[90svh] md:min-h-[90vh] overflow-hidden" style="--hero-bottom: calc(200px + env(safe-area-inset-bottom));">

  <!-- Names (centre) — we pad the bottom by the reserved space so nothing gets pushed off-screen -->
  <div class="flex-1 flex items-center justify-center">
    <div class="max-w-12xl">
      <p class="font-majesty text-2xl md:text-6xl text-orange-300/90 drop-shadow text-left mb-4 ml-1 md:-ml-20">
        
        Join us in celebration
      </p>

      <div class="relative isolate">
        <!-- Gregory -->
        <span class="relative block font-marquis text-[clamp(3.5rem,12vw,8rem)] leading-[1.05] text-orange-200 drop-shadow -translate-x-[2vw]">
          Gregory Humble
        </span>

        <!-- Ampersand -->
        <span class="pointer-events-none absolute inset-0 flex items-center justify-center">
          <span class="font-display text-[clamp(5.2rem,16vw,11rem)] leading-none text-orange-300/95 drop-shadow translate-y-[-8%] md:translate-y-[-8%]">
            &amp;
          </span>
        </span>

        <!-- Drew -->
        <span class="relative block font-marquis text-[clamp(3.5rem,12vw,8rem)] leading-[1.05] text-orange-200 drop-shadow text-right translate-x-[2vw] mt-[20vw] sm:mt-[15vw] md:mt-20">
          Drew Brownlee
        </span>
      </div>
    </div>
  </div>

  <!-- Bottom info area (height matches the reserved space) -->
  <div class="px-4 flex flex-col items-center justify-end min-h-[var(--hero-bottom)]">
    <!-- date/ceremony line -->
    <p class="font-marquis text-stone-50 text-xl md:text-2xl text-center mb-20">
      Friday, 13 February 2026 <span class="mx-2 opacity-70">·</span> Ceremony 3:45&nbsp;pm
    </p>

<!-- countdown (compact glass card) -->
<div class="w-full max-w-md mx-auto mb-3">
  <div class="glass bg-white/15 backdrop-blur-xl border border-white/25 shadow-lg rounded-xl px-4 py-3">
    <span class="block text-center font-quicksand text-[10px] md:text-[11px] tracking-[0.28em] uppercase text-green-400/70 mb-2">
      Time to ceremony
    </span>

    <div class="grid grid-cols-4 gap-2">
      <div class="rounded-lg px-2 py-2 bg-white/78 text-center">
        <div id="cd-days"  class="font-montserrat text-xl md:text-2xl text-green-400/70 leading-none tabular-nums">93</div>
        <div class="font-quicksand text-[10px] uppercase tracking-wider text-green-400/70 mt-0.5">Days</div>
      </div>
      <div class="rounded-lg px-2 py-2 bg-white/78 text-center">
        <div id="cd-hours" class="font-montserrat text-xl md:text-2xl text-green-400/70 leading-none tabular-nums">00</div>
        <div class="font-quicksand text-[10px] uppercase tracking-wider text-green-400/70 mt-0.5">Hours</div>
      </div>
      <div class="rounded-lg px-2 py-2 bg-white/78 text-center">
        <div id="cd-mins"  class="font-montserrat text-xl md:text-2xl text-green-400/70 leading-none tabular-nums">40</div>
        <div class="font-quicksand text-[10px] uppercase tracking-wider text-green-400/70 mt-0.5">Mins</div>
      </div>
      <div class="rounded-lg px-2 py-2 bg-white/78 text-center">
        <div id="cd-secs"  class="font-montserrat text-xl md:text-2xl text-green-400/70 leading-none tabular-nums">00</div>
        <div class="font-quicksand text-[10px] uppercase tracking-wider text-green-400/70 mt-0.5">Secs</div>
      </div>
    </div>
  </div>
</div>
</section>

    
    <!-- DETAILS (tighter paddings/gaps) -->
    <section id="details" class="mx-auto max-w-6xl px-3 py-10 md:py-12">
      <div class="mx-auto max-w-4xl rounded-xl p-5 md:p-6 glass bg-white/15 backdrop-blur-xl border border-white/25 shadow-lg">
        <div class="mb-5 text-center">
          <h2 class="font-marquis text-rose-200 text-2xl md:text-3xl mt-1">The Details</h2>
        </div>
        <div class="grid md:grid-cols-3 gap-3.5">
          <div class="rounded-lg p-3.5 bg-white/78 border border-white/60">
            <p class="text-[11px] uppercase tracking-[0.2em] text-orange-200">RSVP by</p>
            <p class="font-montage text-orange-100 mt-1.5 text-base md:text-lg" data-rsvpby>January 10th, 2026</p>
          </div>
          <div class="rounded-lg p-3.5 bg-white/78 border border-white/60">
            <p class="text-[11px] uppercase tracking-[0.2em] text-orange-200">Dress code</p>
            <p class="font-montage text-orange-100 mt-1.5 text-base md:text-lg" data-dress></p>
          </div>
          <div class="rounded-lg p-3.5 bg-white/78 border border-white/60">
            <p class="text-[11px] uppercase tracking-[0.2em] text-orange-200">Notes</p>
            <p class="font-montage text-orange-100 mt-1.5 text-base md:text-lg" data-notes></p>
          </div>
        </div>
      </div>
    </section>

    <!-- Order of the day -->
    <section id="schedule" class="mx-auto max-w-6xl px-3 py-10 md:py-12">
      <div class="mx-auto max-w-4xl rounded-xl p-5 md:p-6 glass bg-white/15 backdrop-blur-xl border border-white/25 shadow-lg">
        <div class="mb-5 text-center">
          <h2 class="font-marquis text-rose-200 text-2xl md:text-3xl mt-1">Schedule</h2>
        </div>
        <ul class="grid md:grid-cols-2 gap-3">
          <li class="rounded-lg border border-white/60 bg-white/78 p-3">
            <p class="text-[11px] uppercase tracking-[0.2em] text-orange-200">3:45 pm</p>
            <p class="font-montage text-orange-100 mt-1.5 text-base md:text-lg">Ceremony at the Old Treasury Building</p>
          </li>
          <li class="rounded-lg border border-white/60 bg-white/78 p-3">
            <p class="text-[11px] uppercase tracking-[0.2em] text-orange-200">6:30 pm – 9:30 pm</p>
            <p class="font-montage text-orange-100 mt-1.5 text-base md:text-lg">Dinner at Reed House</p>
          </li>
        </ul>
      </div>
    </section>

    <!-- VENUES -->
    <section id="venue" class="mx-auto max-w-6xl px-3 py-10 md:py-12">
      <div class="mx-auto max-w-4xl rounded-xl p-5 md:p-6 glass bg-white/15 backdrop-blur-xl border border-white/25 shadow-lg">
        <div class="mb-5 text-center">
          <h2 class="font-marquis text-rose-200 text-2xl md:text-3xl mt-1">Venues</h2>
        </div>
        <div class="grid lg:grid-cols-2 gap-4 items-start">
          <div class="rounded-lg border border-white/60 bg-white/78 p-3.5">
            <h3 class="font-montage text-orange-100 mt-1.5 text-base md:text-lg">Old Treasury Building</h3>
            <p class="font-montage mt-1.5 text-orange-200">Margaret Craig Room · 20 Spring St, Melbourne VIC</p>
            <a
              href="https://www.google.com/maps?q=20%20Spring%20St%2C%20Melbourne%20VIC"
              data-venue-map
              data-address="20 Spring St, Melbourne VIC"
              target="_blank"
              rel="noreferrer"
              class="font-quicksand mt-1.5 inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-slate-300 hover:border-slate-400 bg-white/85"
            >
              Open in Maps
            </a>
            <p class="font-montage mt-3 text-sm text-orange-100">Please arrive 10–15 minutes early. The ceremony will begin at 4:00 pm.</p>
          </div>
          <div class="rounded-lg border border-white/60 bg-white/78 p-3.5">
            <h3 class="font-montage text-lg font-medium text-orange-100" data-dinner-name>Reed House</h3>
            <p class="font-montage mt-1.5 text-orange-200" data-dinner-address>130 Lonsdale St, Melbourne VIC</p>
            <a
              href="https://www.google.com/maps?q=130%20Lonsdale%20St%2C%20Melbourne%20VIC"
              data-dinner-map
              data-address="130 Lonsdale St, Melbourne VIC"
              target="_blank"
              rel="noreferrer"
              class="font-quicksand mt-1.5 inline-flex items-center gap-2 px-3 py-2 rounded-xl border border-slate-300 hover:border-slate-400 bg-white/85"
            >
              Open in Maps
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- RSVP (stacked single column, tighter) -->
    <section id="rsvp" class="mx-auto font-marquis text-rose-200 max-w-6xl px-3 py-10 md:py-12">
      <div class="mx-auto max-w-4xl rounded-xl p-5 md:p-6 glass bg-white/15 backdrop-blur-xl border border-white/25 shadow-lg">
        <div class="mb-5 text-center">
          <p class="text-[12px] uppercase tracking-[0.2em] text-rose-200">We'd love to celebrate with you</p>
          <h2 class="font-marquis text-2xl md:text-4xl mt-1">RSVP</h2>
        </div>

        <!-- Invite code gate -->
        <div id="invite-gate" class="hidden rounded-lg border border-white/60 bg-white/78 p-4 max-w-xl mx-auto">
          <p class="text-rose-200 mb-2">Please enter your invite code (found on your invitation):</p>
          <div class="flex gap-2.5">
            <input id="invite-code-input" class="w-48 rounded-xl border border-slate-300 input-solid px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300 uppercase" placeholder="e.g. R7K4" maxlength="12">
            <button id="invite-code-continue" class="inline-flex items-center gap-2 bg-slate-900 text-white px-3.5 py-2 rounded-xl">Continue</button>
          </div>
          <p id="invite-code-error" class="mt-2 text-sm text-rose-600 hidden">That code wasn’t recognised. Please check and try again.</p>
        </div>

        <form id="rsvp-form" class="space-y-5">
          <!-- Contact -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3.5">
            <label class="block">
              <span class="block mb-1 text-sm font-marquis font-medium text-stone-100">Your first name *</span>
              <input name="firstName" class="w-full rounded-xl border border-slate-300 input-solid px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
            </label>
            <label class="block">
              <span class="block mb-1 text-sm font-marquis font-medium text-stone-100">Your last name *</span>
              <input name="lastName" class="w-full rounded-xl border border-slate-300 input-solid px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
            </label>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-3.5">
            <label class="block">
              <span class="block mb-1 text-sm font-marquis font-medium text-stone-100">Email *</span>
              <input type="email" name="email" class="w-full rounded-xl border border-slate-300 input-solid px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
            </label>
            <label class="block">
              <span class="block mb-1 text-sm font-marquis font-medium text-stone-100">Phone</span>
              <input name="phone" class="w-full rounded-xl border border-slate-300 input-solid px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
            </label>
          </div>

          <!-- Party size -->
          <label class="block">
            <span id="party-label" class="block mb-1 text-sm font-marquis font-medium text-stone-100">How many people attending (including you)?</span>
            <input type="number" id="party-size" name="partySize" min="1" max="10" value="1" class="w-full rounded-xl border border-slate-300 input-solid px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300">
            <span id="party-hint" class="block mt-1 text-xs text-stone-100"></span>
          </label>

          <!-- Guest list -->
          <div>
            <span class="block mb-1.5 text-sm font-marquis font-medium text-stone-100">Guest details (names, dietaries & attendance)</span>
            <div id="guest-list" class="space-y-3.5"></div>
          </div>

          <!-- Note -->
          <label class="block">
            <span class="block mb-1 text-sm font-marquis font-medium text-stone-100">Message (optional)</span>
            <textarea rows="4" name="note" class="w-full rounded-xl border border-slate-300 input-solid px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300" placeholder="Anything we should know – accessibility, kids, timing, etc."></textarea>
          </label>

<!-- Actions -->
<div class="flex justify-center mt-8">
  <button
    id="submit-btn"
    type="submit"
    class="inline-flex items-center gap-2 px-6 py-3 rounded-xl font-marquis font-medium text-stone-100
           bg-amber-800/60 backdrop-blur-md border border-amber-300/40
           shadow-[0_4px_20px_rgba(255,191,0,0.25)]
           hover:bg-amber-500/80 hover:border-amber-500/60
           hover:shadow-[0_6px_24px_rgba(255,191,0,0.35)]
           transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-rose-300/60"
  >
    Submit RSVP
  </button>
</div>
          <p class="text-xs text-stone-100"></p>
        </form>
      </div>
    </section>

    <footer class="mt-12 py-6 text-center text-sm text-slate-200 drop-shadow">Vibe-coded with ♥ by Greg & Drew</footer>

    <!-- Config first -->
    <script src="./assets/config.js"></script>
    <script src="./assets/invites.js?v=5"></script>
    <script src="./assets/script.js"></script>

    <!-- iOS detection for the fixed-background fallback -->
    <script>
      (function(){
        const ua=navigator.userAgent||"";
        const isIOS=/iPad|iPhone|iPod/.test(ua)||(navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1);
        if(isIOS) document.documentElement.classList.add("ios");
      })();
    </script>

<script>
(function () {
  function toggleIOSBackground(){
    const root = document.documentElement;
    if (!root.classList.contains('ios')) return;
    const hero = document.getElementById('hero');
    if (!hero) return;

    // When scrolled past (hero height - small buffer), enable solid background
    const y = window.pageYOffset || document.documentElement.scrollTop || 0;
    const trigger = hero.offsetHeight - 80;  // tweak buffer if you like
    root.classList.toggle('ios-solid-bg', y > trigger);
  }

  // Run on load and on scroll/resize
  window.addEventListener('load',   toggleIOSBackground, { passive:true });
  window.addEventListener('scroll', toggleIOSBackground, { passive:true });
  window.addEventListener('resize', toggleIOSBackground);
  toggleIOSBackground();
})();
</script>
    
    <!-- Main logic -->
    <script>
      document.addEventListener("DOMContentLoaded",function(){
        const cfg=window.SITE_CONFIG||{};
        const INVITES=window.INVITES||{};
        const CONTACT_EMAIL=cfg.contactEmail||"gregory.r.humble@gmail.com";
        const FORMSPREE=cfg.formspreeEndpoint||"";

        /* Countdown (AUS time) — Fri 13 Feb 2026, 3:45 pm AEDT (+11:00) */
        const WEDDING_TARGET=new Date("2026-02-13T16:00:00+11:00");
        function updateCountdown(){
          const now=new Date();
          let diff=WEDDING_TARGET.getTime()-now.getTime();
          if(diff<0) diff=0;
          const s=Math.floor(diff/1000);
          const days=Math.floor(s/86400);
          const hours=Math.floor((s%86400)/3600);
          const mins=Math.floor((s%3600)/60);
          const secs=s%60;
          const set=(id,val)=>{const el=document.getElementById(id); if(el) el.textContent=String(val).padStart(2,"0");};
          set("cd-days",days); set("cd-hours",hours); set("cd-mins",mins); set("cd-secs",secs);
        }
        updateCountdown(); setInterval(updateCountdown,1000);

        /* Maps links */
        function mapHrefFrom(address){return "https://www.google.com/maps?q="+encodeURIComponent(address);}
        const venueMapEl=document.querySelector("[data-venue-map]");
        const dinnerMapEl=document.querySelector("[data-dinner-map]");
        const ceremonyHref=cfg.event?.mapsUrl||(cfg.event?.venueAddress?mapHrefFrom(cfg.event.venueAddress):"#");
        const dinnerHref=(cfg.event?.dinner?.mapsUrl)||(cfg.event?.dinner?.address?mapHrefFrom(cfg.event.dinner.address):"#");
        if(venueMapEl){venueMapEl.href=ceremonyHref; if(ceremonyHref==="#"){venueMapEl.classList.add("opacity-50","pointer-events-none"); venueMapEl.title="Map link not available";}}
        if(dinnerMapEl){dinnerMapEl.href=dinnerHref; if(dinnerHref==="#"){dinnerMapEl.classList.add("opacity-50","pointer-events-none"); dinnerMapEl.title="Map link not available";}}

        /* Invite code & party size */
        const form=document.getElementById("rsvp-form");
        const gate=document.getElementById("invite-gate");
        const codeInput=document.getElementById("invite-code-input");
        const codeBtn=document.getElementById("invite-code-continue");
        const codeErr=document.getElementById("invite-code-error");
        const partyInput=document.getElementById("party-size");
        const partyHint=document.getElementById("party-hint");
        const guestList=document.getElementById("guest-list");

        function getParam(name){return new URLSearchParams(window.location.search).get(name);}
        function normalizeCode(c){return (c||"").trim().toUpperCase();}
        let CURRENT_INVITE=null;

        const DIETARY=["Vegetarian","Vegan","Gluten free","Dairy free","Nut allergy","Egg allergy","Shellfish allergy"];

        function pillGroupHTML(name, selected = "yes"){
        const tpl = (val, label) => `
        <label class="pill${selected===val ? ' is-active' : ''}">
        <input type="radio" name="${name}" value="${val}" class="sr-only" ${selected===val?'checked':''}>
        ${label}
        </label>`;
        return `
        <div class="flex gap-2.5 flex-wrap" data-pill-group>
        ${tpl("yes","Yes")}
        ${tpl("no","No")}
        ${tpl("unsure","Unsure")}
        </div>`;
        }

        

        function guestCard(index,name=""){
          const n=index+1;
          return `
            <div class="rounded-lg border border-white/60 bg-white/78 p-3.5">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <label class="block">
                  <span class="block mb-1 text-sm font-marquis font-medium field-label">Guest ${n} name ${n===1?"(you) *":"*"}</span>
                  <input name="guestName_${index}" value="${name.replace(/"/g,'&quot;')}" class="w-full rounded-xl border border-slate-300 input-solid px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300" placeholder="${n===1?'Your full name':'Full name'}">
                </label>
                <div></div>
              </div>

              <div class="mt-2.5 grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                  <span class="block mb-1 text-sm font-marquis font-medium text-stone-100">Ceremony?</span>
                  ${pillGroupHTML(`guestCeremony_${index}`,"yes")}
                </div>
                <div>
                  <span class="block mb-1 text-sm font-marquis font-medium text-stone-100">Dinner?</span>
                  ${pillGroupHTML(`guestDinner_${index}`,"yes")}
                </div>
              </div>

              <div class="mt-2.5" data-dietary-for="${index}">
                <span class="block mb-1 text-sm font-marquis font-medium text-stone-100">Dietary requirements</span>
                <div class="grid grid-cols-2 gap-2.5">
                  ${DIETARY.map(d=>`
                    <label class="inline-flex items-center gap-2 rounded-xl border border-slate-300 px-2.5 py-1.5 text-sm text-stone-100 cursor-pointer bg-white/88">
                      <input type="checkbox" name="guestDiet_${index}" value="${d}" class="sr-only"><span>✔</span><span>${d}</span>
                    </label>
                  `).join("")}
                  <input class="w-full rounded-xl border border-slate-300 input-solid px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300 col-span-2" name="guestDietOther_${index}" placeholder="Other (please specify)">
                </div>
              </div>
            </div>
          `;
        }

        function wireDietaryHighlights(scope=document){
          scope.querySelectorAll("input[type='checkbox'][name^='guestDiet_']").forEach(input=>{
            const label=input.closest("label");
            function updateLabel(){label.classList.toggle("bg-slate-500",input.checked);label.classList.toggle("text-white",input.checked);label.classList.toggle("border-slate-900",input.checked);}
            label.addEventListener("click",()=>setTimeout(updateLabel,0));
            input.addEventListener("change",updateLabel);
            updateLabel();
          });
        }

        function wirePills(scope=document){
          scope.querySelectorAll("[data-pill-group]").forEach(group=>{
            const labels = Array.from(group.querySelectorAll(".pill"));
            function setActive(target){
            labels.forEach(l=>l.classList.remove("is-active"));
            target.classList.add("is-active");
            const input = target.querySelector("input[type='radio']");
            if(input) input.checked = true;
          }
            labels.forEach(l=>l.addEventListener("click",()=>setActive(l)));
          });
        }

        // Show/hide dietary section based on Dinner choice per guest
        function updateDietaryVisibility(i){
          const wrapper=document.querySelector(`[data-dietary-for="${i}"]`);
          if(!wrapper) return;
          const radios=Array.from(document.getElementsByName(`guestDinner_${i}`));
          const val=(radios.find(r=>r.checked)?.value)||"yes";
          const hide=(val==="no");
          wrapper.classList.toggle("hidden",hide);
          if(hide){
            wrapper.querySelectorAll(`input[name="guestDiet_${i}"]`).forEach(cb=>{
              cb.checked=false;
              const lbl=cb.closest("label");
              if(lbl) lbl.classList.remove("bg-slate-500","text-white","border-slate-900");
            });
            const other=wrapper.querySelector(`input[name="guestDietOther_${i}"]`);
            if(other) other.value="";
          }
        }
        function wireDinnerVisibilityFor(i){
          const radios=Array.from(document.getElementsByName(`guestDinner_${i}`));
          radios.forEach(r=>{
            r.addEventListener("change",()=>updateDietaryVisibility(i));
            r.addEventListener("click",()=>updateDietaryVisibility(i));
          });
          updateDietaryVisibility(i);
        }

        function renderGuests(count,defaults=[]){
          const size=Math.max(1,Math.min(10,parseInt(count||"1",10)));
          guestList.innerHTML=Array.from({length:size}).map((_,i)=>guestCard(i,defaults[i]||"")).join("");
          wireDietaryHighlights(guestList);
          wirePills(guestList);
          for(let i=0;i<size;i++) wireDinnerVisibilityFor(i);
        }

        function applyInvite(inv){
          CURRENT_INVITE=inv||null;
          const max=inv?.maxGuests??10;
          const defaults=Array.isArray(inv?.defaultNames)?inv.defaultNames:[];
          const defaultCount=Math.max(1,Math.min(defaults.length||max,max));
          partyInput.max=String(max);
          partyInput.value=String(defaultCount);
          partyHint.textContent=inv?`Your invitation allows up to ${max} guest${max>1?"s":""}.`:"";
          renderGuests(defaultCount,defaults);
        }

        function showGate(){
          form.classList.add("hidden");
          gate.classList.remove("hidden");
          codeErr.classList.add("hidden");
          codeBtn.onclick=()=>{
            const entered=(codeInput.value||"").trim().toUpperCase();
            const inv=(INVITES && INVITES[entered])?INVITES[entered]:null;
            if(!inv){codeErr.classList.remove("hidden");return;}
            const url=new URL(window.location.href); url.searchParams.set("code",entered);
            window.history.replaceState({}, "", url.toString());
            gate.classList.add("hidden"); form.classList.remove("hidden");
            applyInvite(inv);
          };
        }

        const hasInviteTable=INVITES && Object.keys(INVITES).length>0;
        const urlCode=(getParam("code")||"").trim().toUpperCase();
        if(hasInviteTable){
          if(urlCode && INVITES[urlCode]){applyInvite(INVITES[urlCode]);} else {showGate();}
        } else {
          applyInvite(null);
        }

        partyInput.addEventListener("input",()=>{
          const max=parseInt(partyInput.max,10)||10;
          let val=parseInt(partyInput.value||"1",10);
          if(isNaN(val)||val<1) val=1;
          if(val>max) val=max;
          partyInput.value=String(val);
          const defaults=(hasInviteTable&&urlCode&&INVITES[urlCode]?.defaultNames)?INVITES[urlCode].defaultNames:[];
          renderGuests(val,defaults);
        });

        /* Submit */
        form.addEventListener("submit",async function(e){
          e.preventDefault();

          const fd=new FormData(form);
          const first=(fd.get("firstName")||"").toString().trim();
          const last=(fd.get("lastName")||"").toString().trim();
          const email=(fd.get("email")||"").toString().trim();
          if(!first||!last||!email){alert("Please complete your first name, last name, and email."); return;}

          const hasTable=INVITES && Object.keys(INVITES).length>0;
          const code=(getParam("code")||"").trim().toUpperCase();
          const inv=(hasTable && INVITES[code])?INVITES[code]:null;

          const phone=(fd.get("phone")||"").toString().trim();
          const partySize=Math.max(1,Math.min(parseInt(document.getElementById("party-size").value||"1",10),inv?.maxGuests??10));
          const note=(fd.get("note")||"").toString().trim();

          const guests=[];
          for(let i=0;i<partySize;i++){
            const name=(fd.get(`guestName_${i}`)||"").toString().trim();
            if(!name){alert(`Please enter a name for Guest ${i+1}.`); return;}
            const ceremony=(fd.get(`guestCeremony_${i}`)||"yes").toString();
            const dinner=(fd.get(`guestDinner_${i}`)||"yes").toString();
            const diets=dinner==="no"?[]:fd.getAll(`guestDiet_${i}`).map(String);
            const other=dinner==="no"?"":(fd.get(`guestDietOther_${i}`)||"").toString().trim();
            const dietarySummary=dinner==="no"?"":[...diets,other?`Other: ${other}`:null].filter(Boolean).join("; ");
            guests.push({index:i+1,name,ceremony,dinner,dietary:diets,dietaryOther:other,dietarySummary});
          }

          const payload={
            invite:inv?{code,household:inv.household,maxGuests:inv.maxGuests}:null,
            contact:{firstName:first,lastName:last,email,phone},
            partySize,
            guests,
            note,
            couple:"Greg & Drew",
            event:{
              dateLong:cfg.event?.dateLong||"Friday, 13 February",
              time:cfg.event?.time||"3:45 pm",
              venueName:cfg.event?.venueName||"Old Treasury Building – Margaret Craig Room",
              venueAddress:cfg.event?.venueAddress||"20 Spring St, Melbourne VIC"
            },
            timestamp:new Date().toISOString()
          };

          if(FORMSPREE){
            try{
              const res=await fetch(FORMSPREE,{
                method:"POST",
                headers:{"Content-Type":"application/json","Accept":"application/json"},
                body:JSON.stringify(payload)
              });
              if(!res.ok) throw new Error("Formspree error "+res.status);
              alert("Thank you! Your RSVP was submitted.");
              form.reset();
              applyInvite(CURRENT_INVITE);
              return;
            }catch(err){
              console.error(err);
              alert("We couldn't reach the RSVP service. We'll open an email instead.");
            }
          }

          // Mailto fallback
          const subject=encodeURIComponent("RSVP — Greg & Drew");
          const lines=[];
          if(inv) lines.push(`Invite code: ${code} (${inv.household})`);
          lines.push(`Contact: ${first} ${last}`);
          lines.push(`Email: ${email}`);
          if(phone) lines.push(`Phone: ${phone}`);
          lines.push(`Party size (attending): ${partySize}${inv?" / max "+inv.maxGuests:""}`);
          lines.push(""); lines.push("Guests:");
          guests.forEach(g=>{
            lines.push(`  • ${g.name} — Ceremony: ${g.ceremony} | Dinner: ${g.dinner}${g.dietarySummary?" | Dietary: "+g.dietarySummary:""}`);
          });
          if(note){lines.push(""); lines.push("Note:"); lines.push(note);}
          const body=encodeURIComponent(lines.join("\n"));
          window.location.href=`mailto:${CONTACT_EMAIL}?subject=${subject}&body=${body}`;
        });
      });
    </script>
  </body>
</html>
